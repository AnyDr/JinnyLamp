
* –ø—Ä–æ–µ–∫—Ç: `D:\esp\jinny_lamp_brain`
* –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ SPIFFS –ª–µ–∂–∞—Ç –≤:
  `D:\esp\jinny_lamp_brain\spiffs_storage\voice\boot_greeting.pcm`
* partition `storage`:

  * offset: `0x560000`
  * size: `0x2A0000` = **2 752 512 bytes**
* COM-–ø–æ—Ä—Ç –ø–ª–∞—Ç—ã: **COM12**

–ù–∏–∂–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è **–ø–æ–¥ —Ç–≤–æ—é —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É**, –ø–ª—é—Å –∫–∞–∫ —ç—Ç–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ –¥–µ—Å—è—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤.

---

# –ß–ê–°–¢–¨ 1. –†–∞–∑–æ–≤–∞—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ (–±–∞–∑–∞)

## 1. –ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É—é –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å)

–û—Å—Ç–∞–≤–ª—è–µ–º –∏–º–µ–Ω–Ω–æ —Ç–∞–∫ –∏ –±–æ–ª—å—à–µ –Ω–µ –º–µ–Ω—è–µ–º:

```
D:\esp\jinny_lamp_brain\
‚îú‚îÄ‚îÄ main\
‚îú‚îÄ‚îÄ components\
‚îú‚îÄ‚îÄ partitions.csv
‚îú‚îÄ‚îÄ spiffs_storage\          ‚Üê –ò–°–¢–û–ß–ù–ò–ö —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ voice\
‚îÇ       ‚îú‚îÄ‚îÄ boot_greeting.pcm
‚îÇ       ‚îú‚îÄ‚îÄ listen_start.pcm
‚îÇ       ‚îú‚îÄ‚îÄ thinking_1.pcm
‚îÇ       ‚îú‚îÄ‚îÄ thinking_2.pcm
‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ spiffs_storage.bin       ‚Üê –°–ì–ï–ù–ï–†–ò–†–û–í–ê–ù–ù–´–ô –û–ë–†–ê–ó
```

–ü—Ä–∞–≤–∏–ª–æ:

* **`spiffs_storage/` ‚Äî —ç—Ç–æ –≤—Å–µ–≥–¥–∞ —Ç–æ, —á—Ç–æ –±—É–¥–µ—Ç `/spiffs` –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ**
* –Ω–∏—á–µ–≥–æ –∏–∑ —ç—Ç–æ–≥–æ **–Ω–µ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è**, —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –¥–∞–Ω–Ω—ã–µ

---

## 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π

–ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Å–æ–∑–¥–∞–Ω–∏–µ–º –æ–±—Ä–∞–∑–∞:

```powershell
cd D:\esp\jinny_lamp_brain
dir .\spiffs_storage\voice
```

–¢—ã –¥–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å:

```
boot_greeting.pcm
```

(–∏ –ø–æ–∑–∂–µ –¥—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã)

---

## 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SPIFFS-–æ–±—Ä–∞–∑–∞ (–ø–æ–¥ —Ç–≤–æ—é —Ä–∞–∑–º–µ—Ç–∫—É)

–ö–æ–º–∞–Ω–¥–∞ **—Å—Ç—Ä–æ–≥–æ —Ç–∞–∫–∞—è**:

```powershell
cd D:\esp\jinny_lamp_brain

python $env:IDF_PATH\components\spiffs\spiffsgen.py `
  2752512 `
  .\spiffs_storage `
  spiffs_storage.bin
```

–ß—Ç–æ –∑–¥–µ—Å—å –≤–∞–∂–Ω–æ:

* `2752512` ‚Äî **–æ–±—è–∑–∞–Ω** —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Ä–∞–∑–º–µ—Ä–æ–º `storage`
* `.\\spiffs_storage` ‚Äî **–∫–æ—Ä–µ–Ω—å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã**
* —Ä–µ–∑—É–ª—å—Ç–∞—Ç: `spiffs_storage.bin` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞

---

## 4. –ü—Ä–æ—à–∏–≤–∫–∞ SPIFFS –≤ –ø–ª–∞—Ç—É (COM12)

–¢–≤–æ—è –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–æ—à–∏–≤–∫–∏:

```powershell
python -m esptool --chip esp32s3 --port COM12 --baud 921600 write_flash 0x560000 spiffs_storage.bin
```

–ì–¥–µ:

* `0x560000` ‚Äî offset `storage`
* `COM12` ‚Äî —Ç–≤–æ—è –ø–ª–∞—Ç–∞

‚ö†Ô∏è **–≠—Ç–æ –Ω–µ OTA**, —ç—Ç–æ –ø—Ä—è–º–∞—è –∑–∞–ø–∏—Å—å data-partition, –∏ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.

---

## 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–ª–∞—Ç–µ

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –≤ –ª–æ–≥–∞—Ö —Ç—ã —É–∂–µ –≤—ã–≤–æ–¥–∏—à—å:

```
STORAGE_FS: List '/spiffs'
```

–û–∂–∏–¥–∞–µ–º–æ —É–≤–∏–¥–µ—Ç—å:

```
/spiffs/voice/boot_greeting.pcm
```

–ï—Å–ª–∏ –µ—Å—Ç—å ‚Äî –≤—Å—ë, –±–∞–∑–∞ –≥–æ—Ç–æ–≤–∞.

---

# –ß–ê–°–¢–¨ 2. –ö–∞–∫ –∂–∏—Ç—å –¥–∞–ª—å—à–µ, –∫–æ–≥–¥–∞ —Ñ–∞–π–ª–æ–≤ —Å—Ç–∞–Ω–µ—Ç 10‚Äì30+

## 1. –°–æ–≥–ª–∞—à–µ–Ω–∏–µ –ø–æ –Ω–µ–π–º–∏–Ω–≥—É (–æ—á–µ–Ω—å –≤–∞–∂–Ω–æ)

–°—Ä–∞–∑—É —Ñ–∏–∫—Å–∏—Ä—É–µ–º –ø—Ä–∞–≤–∏–ª–æ, —á—Ç–æ–±—ã –∫–æ–¥ –±—ã–ª —á–∏—Å—Ç—ã–º:

```
event_<—Å–æ–±—ã—Ç–∏–µ>[_<–≤–∞—Ä–∏–∞–Ω—Ç>].pcm
```

–ü—Ä–∏–º–µ—Ä—ã:

```
boot_greeting.pcm
listen_start.pcm
listen_stop.pcm

thinking_1.pcm
thinking_2.pcm
thinking_3.pcm

cmd_ok_1.pcm
cmd_ok_2.pcm

cmd_fail_1.pcm
cmd_fail_2.pcm
```

–≠—Ç–æ **–∏–¥–µ–∞–ª—å–Ω–æ –ª–æ–∂–∏—Ç—Å—è** –Ω–∞ —Ç–≤–æ—é –±—É–¥—É—â—É—é –ª–æ–≥–∏–∫—É:

* —Å–æ–±—ã—Ç–∏–µ ‚Üí —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ ‚Üí —Å–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤

---

## 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ (—Ä–∞–±–æ—á–∏–π —Ü–∏–∫–ª)

–ö–∞–∂–¥—ã–π —Ä–∞–∑ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ:

1Ô∏è‚É£ –ö–ª–∞–¥—ë—à—å —Ñ–∞–π–ª –≤:

```
D:\esp\jinny_lamp_brain\spiffs_storage\voice\
```

2Ô∏è‚É£ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—à—å –æ–±—Ä–∞–∑:

```powershell
python $env:IDF_PATH\components\spiffs\spiffsgen.py `
  2752512 `
  .\spiffs_storage `
  spiffs_storage.bin
```

3Ô∏è‚É£ –®—å—ë—à—å:

```powershell
python -m esptool --chip esp32s3 --port COM12 --baud 921600 write_flash 0x560000 spiffs_storage.bin
```

4Ô∏è‚É£ –†–µ–±—É—Ç ‚Üí –≥–æ—Ç–æ–≤–æ.

---

## 3. –ß—Ç–æ **–ù–ï** –¥–µ–ª–∞–µ–º (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –±–æ–ª–∏)

‚ùå –ù–µ –ø–∏—à–µ–º –∞—É–¥–∏–æ –≤ OTA-—Å–ª–æ—Ç—ã
‚ùå –ù–µ —Ö—Ä–∞–Ω–∏–º –∞—É–¥–∏–æ –≤ firmware
‚ùå –ù–µ —Å–º–µ—à–∏–≤–∞–µ–º `spiffs_storage` —Å –∏—Å—Ö–æ–¥–Ω–∏–∫–∞–º–∏
‚ùå –ù–µ –º–µ–Ω—è–µ–º —Ä–∞–∑–º–µ—Ä storage –±–µ–∑ –∫—Ä–∞–π–Ω–µ–π –Ω—É–∂–¥—ã

–¢—ã —É–∂–µ –≤—ã–±—Ä–∞–ª **–ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É**, –¥–∞–ª—å—à–µ –æ–Ω–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –±–æ–ª–∏.

---

## 4. –°–ª–µ–¥—É—é—â–∏–π –ª–æ–≥–∏—á–Ω—ã–π —à–∞–≥ (–Ω–æ –Ω–µ —Å–µ–π—á–∞—Å)

–ö–æ–≥–¥–∞ –±—É–¥–µ—à—å –≥–æ—Ç–æ–≤:

* –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ —á–µ—Ä–µ–∑ `idf.py spiffs_flash`
* –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π `voice_pack_v1.bin` –∏ —à–∏—Ç—å –µ–≥–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

üëâ –≠—Ç–æ **P1**, —Å–µ–π—á–∞—Å —Ç—ã –≤—Å—ë —Å–¥–µ–ª–∞–ª –≤–µ—Ä–Ω–æ –≤—Ä—É—á–Ω—É—é.

---

## –ö–æ—Ä–æ—Ç–∫–∏–π –∏—Ç–æ–≥

* –¢—ã –≤—Å—ë —Å–¥–µ–ª–∞–ª **–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ**
* `boot_greeting.pcm` ‚Äî —Ç–µ–ø–µ—Ä—å —Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ, –Ω–µ —Ç–µ—Å—Ç
* SPIFFS –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é
* –º–∞—Å—à—Ç–∞–± –¥–æ –¥–µ—Å—è—Ç–∫–æ–≤ —Ñ–∞–π–ª–æ–≤ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏

–ö–æ–≥–¥–∞ –±—É–¥–µ—à—å –≥–æ—Ç–æ–≤ ‚Äî —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º —Å–¥–µ–ª–∞–µ–º:

* `enum voice_event_t`
* —Ç–∞–±–ª–∏—Ü—É `event ‚Üí —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤`
* –∏ player –±–µ–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –∏ —Å–∞–º–æ–≤–æ–∑–±—É–∂–¥–µ–Ω–∏—è
